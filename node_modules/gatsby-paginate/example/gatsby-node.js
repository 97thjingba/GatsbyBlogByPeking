const path = require(`path`)
const createPaginatedPages = require(`gatsby-paginate`)

const postTemplate = path.resolve(`./src/templates/post.js`)

const query = `
  {
    posts: allMarkdownRemark {
      edges {
        node {
          path: fileAbsolutePath
          frontmatter {
            slug
            purpose
          }
        }
      }
    }
  }
`

exports.createPages = async ({ graphql, actions: { createPage } }) => {
  const response = await graphql(query)
  if (response.errors) throw new Error(response.errors)
  let { content } = response.data
  content.edges.forEach(({ node: { frontmatter } }) => {
    const { slug } = frontmatter
    createPage({
      path: `/blog/` + slug,
      component: postTemplate,
      context: { slug },
    })
  })
}
