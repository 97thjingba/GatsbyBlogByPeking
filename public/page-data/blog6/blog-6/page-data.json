{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog6/blog-6/","webpackCompilationHash":"","result":{"data":{"markdownRemark":{"html":"<h1>不常见的错误</h1>\n<hr>\n<p>我想将Drawer代码抽象为一个Drawer组件的时候，遇见了以下的这个问题.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.</code></pre></div>\n<p>下面我将举例解决这个问题</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import React, { Component } from &#39;react&#39;;\nimport styled from &#39;styled-components&#39;;\n\nclass Item extends React.Component {\n    constructor(props) {\n        super(props);     \n        this.toggle= this.toggle.bind(this);\n        this.state = {\n            details: false\n        } \n    }  \n    toggle(){\n        const currentState = this.state.details;\n        this.setState({ details: !currentState }); \n    }\n\n    render() {\n        return (\n            &lt;tr className=&quot;Item&quot;&gt; \n                &lt;td&gt;{this.props.config.server}&lt;/td&gt;      \n                &lt;td&gt;{this.props.config.verbose}&lt;/td&gt; \n                &lt;td&gt;{this.props.config.type}&lt;/td&gt;\n                &lt;td className={this.state.details ? &quot;visible&quot; : &quot;hidden&quot;}&gt;PLACEHOLDER MORE INFO&lt;/td&gt;\n                {&lt;td&gt;&lt;span onClick={this.toggle()}&gt;Details&lt;/span&gt;&lt;/td&gt;}\n            &lt;/tr&gt;\n    )}\n}\n\nexport default Item;</code></pre></div>\n<p>这里是react 陷入了死循环的问题.(在比较低的版本中不会出现这样的问题可能)</p>\n<p>在Onclick里直接填入this.toggle()并不是一个函数，而是函数的执行。所以到了这一行会直接执行这个函数。但是函数里面调用了SetState这个方法，状态改变以后会重新渲染Dom，也就是再次调用render方法。所以一直这样下去就陷入了死循环里</p>\n<h1>解决方法</h1>\n<p>将<strong><em>函数的执行变成函数的调用</em></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">onClick={this.toggle()}</code></pre></div>\n<p>变成</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">onClick={()=&gt;{this.toggle()}}</code></pre></div>","frontmatter":{"title":"加入Drawer组件","image":{"publicURL":"/static/img-six-02be760e042a43522169c8ee5923830c.jpg"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog6/blog-6/"}}}